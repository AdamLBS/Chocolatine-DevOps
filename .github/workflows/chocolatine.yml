name: Chocolatine
env:
  MIRROR_URL : git@github.com:EpitechPromo2026/B-DOP-200-MAR-2-1-chocolatine-adam.elaoumari.git
  EXECUTABLES : pushswap, salut, bye
on:
  push:
    branches-ignore:
      - 'ga-ignore**'
  pull_request:
    branches-ignore:
      - 'ga-ignore**'

jobs:
    check_repository_cleanliness :
     runs-on: ubuntu-latest
     steps:
        - uses: actions/checkout@v2
          with:
            fetch-depth: 0
        - name: Check for unwanted files
          env:
            VAL: false
          run: |
             echo "VAL=false" >> $GITHUB_ENV
             find * | grep -w --line-buffered ".*\.o$" | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
             find * | grep -w --line-buffered ".*\.a$" | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
             find * | grep -w --line-buffered ".*\.so$" | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
             find * | grep -w --line-buffered ".*\.gcno$" | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
             find * | grep -w --line-buffered ".*\.gcda$" | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
             find * | grep -w --line-buffered ".*\.gcov$" | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
             find * | grep -w --line-buffered ".*\~$" | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
             find * | grep -w --line-buffered "#.*\$" | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
             find * | grep -i -w --line-buffered "pain_au_chocolat"  | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
             find * | grep -i -w --line-buffered "tmp"  | xargs -I {} echo ::error file={},line=1,col=1,title=Unwanted file detected::{} && echo "VAL=true" >> $GITHUB_ENV
        - name: Check for result
          if:  ${{ env.VAL == 'true' }}
          run: exit 1
          continue-on-error: false

    check_program_compilation :
      runs-on: ubuntu-latest
      container:
        image: epitechcontent/epitest-docker
      steps:
        - uses: actions/checkout@v2
          with:
            fetch-depth: 0
        - name: Make
          env:
            TEMP: false
          run : |
            TEST=`echo "${{ env.EXECUTABLES }}" | tr ',' ' '`
            echo $TEST
          timeout-minutes: 2
        - name: make clean
          run: make clean